/*! Clusterize.js - v0.1.0 - 2015-04-29
* http://NeXTs.github.com/Clusterize.js/
* Copyright (c) 2015 Denis Lukov; Licensed MIT */

;(function(f,a){"undefined"!=typeof module?module.exports=a():"function"==typeof define&&"object"==typeof define.amd?define(a):this[f]=a()})("Clusterize",function(){var f=function(a){if(!(this instanceof f))return new f(a);var b=this,c={item_height:0,block_height:0,rows_in_block:50,rows_in_cluster:0,cluster_height:0,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,verify_change:!1};b.options={};"rows_in_block blocks_in_cluster verify_change show_no_data_row no_data_class no_data_text keep_parity tag".split(" ").forEach(function(h){b.options[h]=
"undefined"!=typeof a[h]&&null!=a[h]?a[h]:c[h]});b.scrollElem=a.scrollId?document.getElementById(a.scrollId):a.scrollElem;b.contentElem=a.contentId?document.getElementById(a.contentId):a.contentElem;if(!b.contentElem)throw Error("Error! Could not find content element");if(!b.scrollElem)throw Error("Error! Could not find scroll element");var d=a.rows||[],e={data:""},l=b.scrollElem.scrollTop;b.calcClusterHeight(d);b.insertToDOM(d,e);b.scrollElem.scrollTop=l;var k=!1,g=function(){k!=(k=b.getClusterNum())&&
b.insertToDOM(d,e)};b.scrollElem.addEventListener("scroll",g);b.destroy=function(a){b.scrollElem.removeEventListener("scroll",g);b.contentElem.innerHTML=a?b.generateEmptyRow().join(""):d.join("")};b.update=function(a){d=b.isArray(a)?a:[];a=b.scrollElem.scrollTop;b.insertToDOM(d,e);b.scrollElem.scrollTop=a};b.append=function(a){a=b.isArray(a)?a:[];a.length&&(d=d.concat(a),b.insertToDOM(d,e))};b.clear=function(){b.update([])};b.getRowsAmount=function(){return d.length}};f.prototype={constructor:f,calcClusterHeight:function(a){var b=
this.options;if(!b.item_height||!b.tag){if(!a.length)return;this.contentElem.innerHTML=a[0]+a[0]+a[0];a=this.contentElem.children[1];b.tag||(b.tag=a.tagName.toLowerCase());b.item_height=a.offsetHeight}b.block_height=b.item_height*b.rows_in_block;b.rows_in_cluster=b.blocks_in_cluster*b.rows_in_block;b.cluster_height=b.blocks_in_cluster*b.block_height},getClusterNum:function(){var a=this.options;return Math.floor(this.scrollElem.scrollTop/(a.cluster_height-a.block_height))},generateEmptyRow:function(){var a=
this.options;if(!a.tag||!a.show_no_data_row)return[];var b="<"+a.tag+' class="'+a.no_data_class+'">';switch(a.tag){case "tr":b+="<td>"+a.no_data_text+"</td>";break;default:b+=a.no_data_text}b+="</"+a.tag+">";return[b]},generate:function(a,b){var c=this.options,d=a.length;if(!d)return this.generateEmptyRow();if(d<c.rows_in_block)return a;c.cluster_height||this.calcClusterHeight(a);var e=b*c.rows_in_cluster-c.rows_in_block*b,e=0<e?e:0,f=e+c.rows_in_cluster,k=e*c.item_height,d=(d-f)*c.item_height,g=
[];0<k&&(c.keep_parity&&g.push("<"+c.tag+' class="clusterize-extra-row clusterize-keep-parity"></'+c.tag+">"),g.push("<"+c.tag+' class="clusterize-extra-row clusterize-top-space" style="height:'+k+'px;"></'+c.tag+">"));for(;e<f;e++)a[e]&&g.push(a[e]);0<d&&g.push("<"+c.tag+' class="clusterize-extra-row clusterize-bottom-space" style="height:'+d+'px;"></'+c.tag+">");return g},insertToDOM:function(a,b){var c=this.generate(a,this.getClusterNum()).join("");if(!this.options.verify_change||this.options.verify_change&&
this.dataChanged(c,b))this.contentElem.innerHTML=c},dataChanged:function(a,b){var c=JSON.stringify(a);return c!==b.data&&(b.data=c)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)}};return f});